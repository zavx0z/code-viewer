<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>code-viewer</title>
    <script src="//cdn.jsdelivr.net/npm/eruda"></script>
    <script type="module" src="./dev/devTools.js"></script>
    <link rel="stylesheet" type="text/css" href="./dev/styles.css" />
    <script type="module" async defer>
      // const { proto } = await import("https://zavx0z.github.io/code-viewer/index.js")
      await import("./index.js")

      const actor = document.querySelector("code-viewer")
      console.log(actor)
      document.querySelector("h1").textContent = actor.name

      const textarea = document.querySelector("textarea")
      const linenoCheckBox = document.getElementById("lineno")
      const foldCheckBox = document.getElementById("fold")

      let persistence = localStorage.getItem("code-viewer")
      if (persistence) actor.state = JSON.parse(persistence)

      actor.subscribe((snapshot) => {
        localStorage.setItem(
          "code-viewer",
          JSON.stringify({
            input: {
              src: textarea.value,
              lineno: linenoCheckBox.checked,
              fold: foldCheckBox.checked,
            },
            output: {
              dst: snapshot,
            },
          })
        )
      })

      document.querySelector('label[for="src"]').innerText = actor.input.src.name.ru
      document.querySelector('label[for="lineno"]').innerText = actor.input.lineno.name.ru
      document.querySelector('label[for="fold"]').innerText = actor.input.fold.name.ru

      function process() {
        actor.send({ lineno: linenoCheckBox.checked, fold: foldCheckBox.checked, src: textarea.value })
      }

      textarea.addEventListener("change", process)
      linenoCheckBox.addEventListener("change", process)
      foldCheckBox.addEventListener("change", process)

      linenoCheckBox.checked = actor.input.lineno.value
      foldCheckBox.checked = actor.input.fold.value
      textarea.value = actor.input.src.value
    </script>
  </head>

  <body>
    <h1></h1>
    <div>
      <input type="checkbox" id="lineno" name="lineno" checked />
      <label for="lineno"></label>
    </div>
    <div>
      <input type="checkbox" id="fold" name="fold" checked />
      <label for="fold"></label>
    </div>
    <div>
      <label for="src"></label>
      <textarea cols="80" rows="4" id="src" name="codeSrc"></textarea>
    </div>
    <code-viewer />
  </body>
</html>
